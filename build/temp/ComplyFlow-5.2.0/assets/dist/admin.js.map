{"version":3,"file":"admin.js","sources":["../src/js/admin.js"],"sourcesContent":["/**\r\n * Admin JavaScript\r\n *\r\n * Main admin functionality for ComplyFlow.\r\n *\r\n * @package ComplyFlow\r\n * @since 1.0.0\r\n */\r\n\r\n(function ($) {\r\n    'use strict';\r\n\r\n    /**\r\n     * ComplyFlow Admin Object\r\n     */\r\n    const ComplyFlowAdmin = {\r\n        /**\r\n         * Initialize\r\n         */\r\n        init() {\r\n            this.cacheElements();\r\n            this.bindEvents();\r\n            this.initComponents();\r\n        },\r\n\r\n        /**\r\n         * Cache frequently accessed DOM elements\r\n         */\r\n        cacheElements() {\r\n            this.$indicator = $('#complyflow-save-indicator');\r\n            this.$indicatorSpinner = this.$indicator.find('.spinner');\r\n            this.$notices = $('#complyflow-settings-notices');\r\n        },\r\n\r\n        /**\r\n         * Bind events\r\n         */\r\n        bindEvents() {\r\n            // Settings form submission\r\n            $(document).on('submit', '.complyflow-settings-form', this.saveSettings.bind(this));\r\n\r\n            // Tab navigation\r\n            $(document).on('click', '.complyflow-tab', this.switchTab.bind(this));\r\n\r\n            // Run scan button\r\n            $(document).on('click', '.complyflow-run-scan', this.runScan.bind(this));\r\n        },\r\n\r\n        /**\r\n         * Initialize components\r\n         */\r\n        initComponents() {\r\n            // Initialize tooltips if present\r\n            if (typeof tippy !== 'undefined') {\r\n                tippy('[data-tippy-content]');\r\n            }\r\n\r\n            // Initialize charts if Chart.js is loaded\r\n            if (typeof Chart !== 'undefined') {\r\n                this.initCharts();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Save settings via AJAX\r\n         */\r\n        saveSettings(e) {\r\n            e.preventDefault();\r\n\r\n            const $form = $(e.currentTarget);\r\n            const $button = $form.find('button[type=\"submit\"]');\r\n            const buttonText = $button.text();\r\n\r\n            // Disable button\r\n            $button.prop('disabled', true).text(complyflowAdmin.strings.saving || 'Saving...');\r\n            this.clearNotices();\r\n            this.setSaveIndicator(true, complyflowAdmin.strings.saving || 'Saving...');\r\n\r\n            $.ajax({\r\n                url: complyflowAdmin.ajaxUrl,\r\n                type: 'POST',\r\n                data: {\r\n                    action: 'complyflow_save_settings',\r\n                    nonce: complyflowAdmin.nonce,\r\n                    settings: $form.serialize(),\r\n                },\r\n                success(response) {\r\n                    if (response.success) {\r\n                        ComplyFlowAdmin.showNotice('success', complyflowAdmin.strings.saved);\r\n                    } else {\r\n                        ComplyFlowAdmin.showNotice('error', response.data.message || complyflowAdmin.strings.error);\r\n                    }\r\n                },\r\n                error() {\r\n                    ComplyFlowAdmin.showNotice('error', complyflowAdmin.strings.error);\r\n                },\r\n                complete() {\r\n                    $button.prop('disabled', false).text(buttonText);\r\n                    ComplyFlowAdmin.setSaveIndicator(false);\r\n                },\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Switch tabs\r\n         */\r\n        switchTab(e) {\r\n            e.preventDefault();\r\n\r\n            const $tab = $(e.currentTarget);\r\n            const target = $tab.data('tab');\r\n\r\n            // Update active states\r\n            $('.complyflow-tab').removeClass('active');\r\n            $tab.addClass('active');\r\n\r\n            // Show target content\r\n            $('.complyflow-tab-content').removeClass('active');\r\n            $(`.complyflow-tab-content[data-tab=\"${target}\"]`).addClass('active');\r\n\r\n            // Update URL without reload\r\n            if (history.pushState) {\r\n                const url = new URL(window.location);\r\n                url.searchParams.set('tab', target);\r\n                history.pushState({}, '', url);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Run accessibility scan\r\n         */\r\n        runScan(e) {\r\n            e.preventDefault();\r\n\r\n            const $button = $(e.currentTarget);\r\n            const buttonText = $button.text();\r\n\r\n            $button.prop('disabled', true).text('Scanning...');\r\n\r\n            $.ajax({\r\n                url: complyflowAdmin.ajaxUrl,\r\n                type: 'POST',\r\n                data: {\r\n                    action: 'complyflow_run_scan',\r\n                    nonce: complyflowAdmin.nonce,\r\n                },\r\n                success(response) {\r\n                    if (response.success) {\r\n                        ComplyFlowAdmin.showNotice('success', 'Scan completed successfully');\r\n                        // Reload results\r\n                        location.reload();\r\n                    } else {\r\n                        ComplyFlowAdmin.showNotice('error', response.data.message);\r\n                    }\r\n                },\r\n                error() {\r\n                    ComplyFlowAdmin.showNotice('error', 'Scan failed. Please try again.');\r\n                },\r\n                complete() {\r\n                    $button.prop('disabled', false).text(buttonText);\r\n                },\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Show admin notice\r\n         */\r\n        showNotice(type, message) {\r\n            const $notice = $(`\r\n                <div class=\"notice notice-${type} is-dismissible\">\r\n                    <p>${message}</p>\r\n                    <button type=\"button\" class=\"notice-dismiss\">\r\n                        <span class=\"screen-reader-text\">Dismiss</span>\r\n                    </button>\r\n                </div>\r\n            `);\r\n\r\n            const $container = this.$notices.length ? this.$notices : $('.complyflow-page-header');\r\n\r\n            if (this.$notices.length) {\r\n                this.$notices.empty().append($notice);\r\n            } else {\r\n                $container.after($notice);\r\n            }\r\n\r\n            // Auto-dismiss after 5 seconds\r\n            setTimeout(() => {\r\n                $notice.fadeOut(() => $notice.remove());\r\n            }, 5000);\r\n\r\n            // Manual dismiss\r\n            $notice.find('.notice-dismiss').on('click', function () {\r\n                $notice.fadeOut(() => $notice.remove());\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Initialize charts\r\n         */\r\n        initCharts() {\r\n            // Compliance score chart\r\n            const $scoreChart = $('#complyflow-score-chart');\r\n            if ($scoreChart.length) {\r\n                const score = parseInt($scoreChart.data('score'), 10) || 0;\r\n                \r\n                new Chart($scoreChart[0], {\r\n                    type: 'doughnut',\r\n                    data: {\r\n                        datasets: [{\r\n                            data: [score, 100 - score],\r\n                            backgroundColor: ['#06d6a0', '#e5e7eb'],\r\n                            borderWidth: 0,\r\n                        }],\r\n                    },\r\n                    options: {\r\n                        cutout: '80%',\r\n                        plugins: {\r\n                            legend: {\r\n                                display: false,\r\n                            },\r\n                            tooltip: {\r\n                                enabled: false,\r\n                            },\r\n                        },\r\n                    },\r\n                });\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Clear notices container\r\n         */\r\n        clearNotices() {\r\n            if (this.$notices.length) {\r\n                this.$notices.empty();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Toggle save indicator\r\n         *\r\n         * @param {boolean} isActive\r\n         * @param {string} [text]\r\n         */\r\n        setSaveIndicator(isActive, text = '') {\r\n            if (!this.$indicator || !this.$indicator.length) {\r\n                return;\r\n            }\r\n\r\n            if (isActive) {\r\n                this.$indicator.addClass('is-active').attr('aria-hidden', 'false');\r\n                if (this.$indicatorSpinner.length) {\r\n                    this.$indicatorSpinner.addClass('is-active');\r\n                }\r\n                if (text) {\r\n                    this.$indicator.find('.save-text').text(text);\r\n                }\r\n            } else {\r\n                this.$indicator.removeClass('is-active').attr('aria-hidden', 'true');\r\n                if (this.$indicatorSpinner.length) {\r\n                    this.$indicatorSpinner.removeClass('is-active');\r\n                }\r\n            }\r\n        },\r\n    };\r\n\r\n    /**\r\n     * Initialize on document ready\r\n     */\r\n    $(document).ready(() => {\r\n        ComplyFlowAdmin.init();\r\n    });\r\n\r\n})(jQuery);\r\n"],"names":["$","ComplyFlowAdmin","init","this","cacheElements","bindEvents","initComponents","$indicator","$indicatorSpinner","find","$notices","document","on","saveSettings","bind","switchTab","runScan","tippy","Chart","initCharts","e","preventDefault","$form","currentTarget","$button","buttonText","text","prop","complyflowAdmin","strings","saving","clearNotices","setSaveIndicator","ajax","url","ajaxUrl","type","data","action","nonce","settings","serialize","success","response","showNotice","saved","message","error","complete","$tab","target","removeClass","addClass","history","pushState","URL","window","location","searchParams","set","reload","$notice","$container","length","empty","append","after","setTimeout","fadeOut","remove","$scoreChart","score","parseInt","datasets","backgroundColor","borderWidth","options","cutout","plugins","legend","display","tooltip","enabled","isActive","attr","ready","jQuery"],"mappings":"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"}