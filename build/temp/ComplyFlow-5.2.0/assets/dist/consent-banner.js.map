{"version":3,"file":"consent-banner.js","sources":["../src/js/consent-banner.js"],"sourcesContent":["/**\r\n * Consent Banner JavaScript\r\n *\r\n * Handles cookie consent banner interactions.\r\n *\r\n * @package ComplyFlow\r\n * @since   1.0.0\r\n */\r\n\r\n(function($) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Consent Banner Manager\r\n     */\r\n    var ConsentBanner = {\r\n        /**\r\n         * Initialize\r\n         */\r\n        init: function() {\r\n            this.checkConsent();\r\n            this.bindEvents();\r\n        },\r\n\r\n        /**\r\n         * Check if user has already consented\r\n         */\r\n        checkConsent: function() {\r\n            var consent = this.getConsent();\r\n            \r\n            if (consent) {\r\n                // User has consented, hide banner\r\n                $('#complyflow-consent-banner').remove();\r\n            } else {\r\n                // No consent yet, show the banner after 3 seconds\r\n                setTimeout(function() {\r\n                    $('#complyflow-consent-banner').fadeIn(600);\r\n                }, 3000);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Get consent from cookie\r\n         *\r\n         * @return {Object|null} Consent object or null.\r\n         */\r\n        getConsent: function() {\r\n            var name = 'complyflow_consent=';\r\n            var decodedCookie = decodeURIComponent(document.cookie);\r\n            var ca = decodedCookie.split(';');\r\n            \r\n            for (var i = 0; i < ca.length; i++) {\r\n                var c = ca[i];\r\n                while (c.charAt(0) === ' ') {\r\n                    c = c.substring(1);\r\n                }\r\n                if (c.indexOf(name) === 0) {\r\n                    try {\r\n                        return JSON.parse(c.substring(name.length, c.length));\r\n                    } catch (e) {\r\n                        return null;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            return null;\r\n        },\r\n\r\n        /**\r\n         * Set consent cookie\r\n         *\r\n         * @param {Object} consent Consent object.\r\n         */\r\n        setConsent: function(consent) {\r\n            var duration = complyflowConsent.settings.consentDuration || 365;\r\n            var date = new Date();\r\n            date.setTime(date.getTime() + (duration * 24 * 60 * 60 * 1000));\r\n            \r\n            var expires = 'expires=' + date.toUTCString();\r\n            document.cookie = 'complyflow_consent=' + JSON.stringify(consent) + ';' + expires + ';path=/;SameSite=Lax';\r\n            \r\n            // Trigger event for script unblocking\r\n            var event = new CustomEvent('complyflowConsentUpdated', {\r\n                detail: consent\r\n            });\r\n            document.dispatchEvent(event);\r\n        },\r\n\r\n        /**\r\n         * Bind events\r\n         */\r\n        bindEvents: function() {\r\n            var self = this;\r\n\r\n            // Accept all button\r\n            $(document).on('click', '#cf-consent-accept-all', function(e) {\r\n                e.preventDefault();\r\n                self.acceptAll();\r\n            });\r\n\r\n            // Reject all button\r\n            $(document).on('click', '#cf-consent-reject-all', function(e) {\r\n                e.preventDefault();\r\n                self.rejectAll();\r\n            });\r\n\r\n            // Save preferences button\r\n            $(document).on('click', '#cf-consent-save-preferences', function(e) {\r\n                e.preventDefault();\r\n                self.savePreferences();\r\n            });\r\n\r\n            // Cookie settings link\r\n            $(document).on('click', '#cf-cookie-settings', function(e) {\r\n                e.preventDefault();\r\n                self.showPreferences();\r\n            });\r\n\r\n            // Toggle switch changes\r\n            $(document).on('change', '.cf-consent-toggle input', function() {\r\n                var $toggle = $(this);\r\n                var category = $toggle.attr('id').replace('complyflow-toggle-', '');\r\n                \r\n                // Visual feedback\r\n                $toggle.closest('.cf-consent-category').toggleClass('active', $toggle.prop('checked'));\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Accept all cookies\r\n         */\r\n        acceptAll: function() {\r\n            var self = this;\r\n            var consent = {\r\n                necessary: true,\r\n                analytics: true,\r\n                marketing: true,\r\n                preferences: true\r\n            };\r\n\r\n            // Fade out banner before saving\r\n            $('#complyflow-consent-banner').fadeOut(400, function() {\r\n                self.saveConsent(consent);\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Reject all cookies\r\n         */\r\n        rejectAll: function() {\r\n            var self = this;\r\n            var consent = {\r\n                necessary: true,\r\n                analytics: false,\r\n                marketing: false,\r\n                preferences: false\r\n            };\r\n\r\n            // Fade out banner before saving\r\n            $('#complyflow-consent-banner').fadeOut(400, function() {\r\n                self.saveConsent(consent);\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Save custom preferences\r\n         */\r\n        savePreferences: function() {\r\n            var self = this;\r\n            var consent = {\r\n                necessary: true,\r\n                analytics: $('#cf-toggle-analytics').prop('checked'),\r\n                marketing: $('#cf-toggle-marketing').prop('checked'),\r\n                preferences: $('#cf-toggle-preferences').prop('checked')\r\n            };\r\n\r\n            // Fade out banner before saving\r\n            $('#complyflow-consent-banner').fadeOut(400, function() {\r\n                self.saveConsent(consent);\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Save consent\r\n         *\r\n         * @param {Object} consent Consent object.\r\n         */\r\n        saveConsent: function(consent) {\r\n            var self = this;\r\n\r\n            // Show loading state\r\n            this.showLoading();\r\n\r\n            // Prepare data\r\n            var ajaxData = {\r\n                action: 'complyflow_save_consent',\r\n                nonce: complyflowConsent.nonce,\r\n                necessary: consent.necessary ? 'true' : 'false',\r\n                analytics: consent.analytics ? 'true' : 'false',\r\n                marketing: consent.marketing ? 'true' : 'false',\r\n                preferences: consent.preferences ? 'true' : 'false'\r\n            };\r\n\r\n            // Save to server\r\n            $.ajax({\r\n                url: complyflowConsent.ajaxUrl,\r\n                type: 'POST',\r\n                data: ajaxData,\r\n                success: function(response) {\r\n                    if (response.success) {\r\n                        // Set cookie\r\n                        self.setConsent(consent);\r\n\r\n                        // Banner already faded out, just reload\r\n                        setTimeout(function() {\r\n                            window.location.reload();\r\n                        }, 300);\r\n                    } else {\r\n                        console.error('ComplyFlow: Save failed', response);\r\n                        alert(response.data.message || 'Failed to save consent');\r\n                        self.hideLoading();\r\n                        // Show banner again on error\r\n                        $('#complyflow-consent-banner').fadeIn(300);\r\n                    }\r\n                },\r\n                error: function(xhr, status, error) {\r\n                    console.error('ComplyFlow: AJAX error', xhr, status, error);\r\n                    alert('Failed to save consent. Please try again.');\r\n                    self.hideLoading();\r\n                }\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Show preferences center\r\n         */\r\n        showPreferences: function() {\r\n            // If already showing categories, just scroll to them\r\n            if ($('.cf-consent-categories').is(':visible')) {\r\n                $('html, body').animate({\r\n                    scrollTop: $('.cf-consent-categories').offset().top - 100\r\n                }, 500);\r\n                return;\r\n            }\r\n\r\n            // Show categories section\r\n            $('.cf-consent-categories').slideDown();\r\n            \r\n            // Update button text\r\n            $('#complyflow-cookie-settings').text('Hide Settings');\r\n        },\r\n\r\n        /**\r\n         * Hide banner\r\n         */\r\n        hideBanner: function() {\r\n            $('#complyflow-consent-banner').fadeOut(300, function() {\r\n                $(this).remove();\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Show loading state\r\n         */\r\n        showLoading: function() {\r\n            $('.cf-consent-actions button').prop('disabled', true).addClass('loading');\r\n        },\r\n\r\n        /**\r\n         * Hide loading state\r\n         */\r\n        hideLoading: function() {\r\n            $('.cf-consent-actions button').prop('disabled', false).removeClass('loading');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Cookie Scanner\r\n     */\r\n    var CookieScanner = {\r\n        /**\r\n         * Scan cookies\r\n         *\r\n         * @param {string} url URL to scan.\r\n         * @return {Promise} Promise that resolves with scan results.\r\n         */\r\n        scan: function(url) {\r\n            return $.ajax({\r\n                url: complyflowConsent.ajaxUrl,\r\n                type: 'POST',\r\n                data: {\r\n                    action: 'complyflow_scan_cookies',\r\n                    nonce: complyflowConsent.nonce,\r\n                    url: url || window.location.href\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Initialize on document ready\r\n     */\r\n    $(document).ready(function() {\r\n        ConsentBanner.init();\r\n    });\r\n\r\n    // Export to global scope\r\n    window.ComplyFlowConsent = {\r\n        banner: ConsentBanner,\r\n        scanner: CookieScanner\r\n    };\r\n\r\n})(jQuery);\r\n"],"names":["$","ConsentBanner","CookieScanner","jQuery","init","this","checkConsent","bindEvents","getConsent","remove","setTimeout","fadeIn","name","ca","decodeURIComponent","document","cookie","split","i","length","c","charAt","substring","indexOf","JSON","parse","e","setConsent","consent","duration","complyflowConsent","settings","consentDuration","date","Date","setTime","getTime","expires","toUTCString","stringify","event","CustomEvent","detail","dispatchEvent","self","on","preventDefault","acceptAll","rejectAll","savePreferences","showPreferences","$toggle","attr","replace","closest","toggleClass","prop","necessary","analytics","marketing","preferences","fadeOut","saveConsent","showLoading","ajaxData","action","nonce","ajax","url","ajaxUrl","type","data","success","response","window","location","reload","console","error","alert","message","hideLoading","xhr","status","is","animate","scrollTop","offset","top","slideDown","text","hideBanner","addClass","removeClass","scan","href","ready","ComplyFlowConsent","banner","scanner"],"mappings":"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"}